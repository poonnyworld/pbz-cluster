// file: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ==========================================
// üõ°Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á User & Honor
// ==========================================

model User {
  id            String   @id
  username      String?
  souls         Int      @default(0)
  lastDaily     DateTime?
  
  flipCount     Int      @default(0)
  lastFlipReset DateTime @default(now())
  
  inventory     InventoryItem[]
  
  // ‚úÖ ‡πÅ‡∏Å‡πâ relation ‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏´‡∏≤ UserAnswer ‡πÅ‡∏ó‡∏ô QuizAttempt
  answers       UserAnswer[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ShopItem ‡πÄ‡∏õ‡πá‡∏ô Item ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î JS (‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ß‡πà‡∏≤ prisma.item)
model Item {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  cost        Int      // ‡πÅ‡∏Å‡πâ price ‡πÄ‡∏õ‡πá‡∏ô cost ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î JS
  stock       Int      @default(-1)
  isActive    Boolean  @default(true)
  
  owners      InventoryItem[]
}

model InventoryItem {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  item        Item     @relation(fields: [itemId], references: [id])
  itemId      Int
  purchasedAt DateTime @default(now())
}

// ==========================================
// üéâ ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Quiz & Event Bot
// ==========================================

model QuizSet {
  id             Int            @id @default(autoincrement())
  title          String
  description    String?
  status         String         @default("DRAFT") 

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á Quiz (STANDARD ‡∏´‡∏£‡∏∑‡∏≠ BINGO)
  type           String         @default("BINGO")

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á Role ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏à‡∏Å (‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô String ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Discord ID ‡∏¢‡∏≤‡∏ß)
  completionRoleId String?
  
  panelMessageId String?
  panelChannelId String?
  questions      QuizQuestion[]
  createdAt      DateTime       @default(now())
}

model QuizQuestion {
  id           Int           @id @default(autoincrement())
  setId        Int?
  set          QuizSet?      @relation(fields: [setId], references: [id])
  order        Int           @default(0)
  question     String
  
  inputType    String        @default("TEXT") // "BOOLEAN", "CHOICE", "TEXT"
  options      String?       // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å JSON ‡πÄ‡∏ä‡πà‡∏ô '["Jan","Feb",...]'
  manualGrading Boolean  @default(false) // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏≠‡∏á

  answers      String        
  rewardPoints Int           @default(100)
  isActive     Boolean       @default(true)
  userAnswers  UserAnswer[]  
  createdAt    DateTime      @default(now())
}

// ‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏£‡∏ß‡∏° Attempt + Answer ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
model UserAnswer {
  id         Int          @id @default(autoincrement())
  
  userId     String
  user       User         @relation(fields: [userId], references: [id])
  
  questionId Int
  question   QuizQuestion @relation(fields: [questionId], references: [id])
  
  answer     String       // ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà user ‡∏û‡∏¥‡∏°‡∏û‡πå
  isCorrect  Boolean?     @default(false) // ‚úÖ ‡πÅ‡∏Å‡πâ: ‡πÉ‡∏™‡πà ? ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô null (Pending) ‡πÑ‡∏î‡πâ
  answeredAt DateTime     @default(now())

  @@unique([userId, questionId])
}

// ==========================================
// ‚öôÔ∏è System Config
// ==========================================
model SystemConfig {
  key       String   @id
  value     Boolean  @default(false)
  updatedAt DateTime @updatedAt
}